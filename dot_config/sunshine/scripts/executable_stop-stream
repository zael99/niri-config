#!/bin/bash

BACKUP_FILE="/tmp/hyprland_monitor_layout"

if [ ! -f "$BACKUP_FILE" ]; then
    echo "Error: Backup file not found at $BACKUP_FILE"
    exit 1
fi

# 1. Identify and remove headless displays
headless_monitors=$(hyprctl monitors -j | jq -r '.[] | select(.name | startswith("HEADLESS-")) | .name')

for mon in $headless_monitors; do
    hyprctl output remove "$mon"
done

# 2. Restore physical monitors from backup
# We extract name, width, height, refresh rate, x, y, and scale
jq -c '.[]' "$BACKUP_FILE" | while read -r mon; do
    NAME=$(echo "$mon" | jq -r '.name')
    WIDTH=$(echo "$mon" | jq -r '.width')
    HEIGHT=$(echo "$mon" | jq -r '.height')
    REFRESH=$(echo "$mon" | jq -r '.refreshRate')
    X=$(echo "$mon" | jq -r '.x')
    Y=$(echo "$mon" | jq -r '.y')
    SCALE=$(echo "$mon" | jq -r '.scale')

    # Re-enable monitor with original settings
    hyprctl keyword monitor "$NAME,${WIDTH}x${HEIGHT}@${REFRESH},${X}x${Y},$SCALE"
done

# 3. Clean up
rm "$BACKUP_FILE"
echo "Headless display removed. Physical monitors restored."